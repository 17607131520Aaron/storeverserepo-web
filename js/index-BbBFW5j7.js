import{i as e}from"./chunk-Dh7eWoLx.js";import{D as s,E as a,F as n,o as t,w as l}from"./chunk-DRz1mV9D.js";import{C as i,D as r,E as o,H as c,L as h,N as d,O as m,P as p,R as u,S as b,W as f,X as y,_ as k,b as x,c as j,d as g,f as v,g as N,h as C,j as T,k as w,m as S,n as E,s as K,v as P,x as R,y as D}from"./chunk-DgmtKtlG.js";import{_ as L}from"./chunk-Cd6TlBs2.js";import{t as A}from"./chunk-DNUzPS6a.js";var $=e(n(),1),O=t();const z=[{key:"/",icon:(0,O.jsx)(o,{}),label:"首页"},{key:"dashboard",icon:(0,O.jsx)(h,{}),label:"仪表盘",children:[{key:"/dashboard/overview",icon:(0,O.jsx)(p,{}),label:"数据概览"},{key:"/dashboard/analysis",icon:(0,O.jsx)(h,{}),label:"统计分析"}]},{key:"documents",icon:(0,O.jsx)(m,{}),label:"文档管理",children:[{key:"/documents/list",icon:(0,O.jsx)(m,{}),label:"文档列表"},{key:"/documents/category",icon:(0,O.jsx)(r,{}),label:"文档分类"},{key:"/documents/trash",icon:(0,O.jsx)(T,{}),label:"回收站"}]},{key:"team",icon:(0,O.jsx)(k,{}),label:"团队管理",children:[{key:"/team/members",icon:(0,O.jsx)(S,{}),label:"成员管理"},{key:"/team/roles",icon:(0,O.jsx)(C,{}),label:"角色权限"},{key:"/team/departments",icon:(0,O.jsx)(k,{}),label:"部门管理"}]},{key:"barcode",icon:(0,O.jsx)(p,{}),label:"条码管理",children:[{key:"/barcode/manage",icon:(0,O.jsx)(p,{}),label:"条码生成"}]},{key:"settings",icon:(0,O.jsx)(P,{}),label:"系统设置",children:[{key:"/settings/basic",icon:(0,O.jsx)(P,{}),label:"基础设置"},{key:"/settings/security",icon:(0,O.jsx)(D,{}),label:"安全设置"},{key:"/settings/logs",icon:(0,O.jsx)(w,{}),label:"日志管理"}]},{key:"rndebug",icon:(0,O.jsx)(d,{}),label:"服务通APP调试工具",children:[{key:"/smartserviceappDebug/debuglogs",icon:(0,O.jsx)(N,{}),label:"日志"},{key:"/smartserviceappDebug/network",icon:(0,O.jsx)(u,{}),label:"网络"}]}],B=[{key:"profile",icon:(0,O.jsx)(C,{}),label:"个人中心"},{key:"settings",icon:(0,O.jsx)(P,{}),label:"账户设置"},{type:"divider"},{key:"logout",icon:(0,O.jsx)(i,{}),label:"退出登录",danger:!0}];var W=(0,$.createContext)(void 0),H=e=>{const s=a=>{for(const n of a)if(n&&"string"!=typeof n){if(n.key===e&&"label"in n&&n.label)return"string"==typeof n.label?n.label:String(n.label);if("children"in n&&n.children){const e=s(n.children);if(e)return e}}return null};return s(z||[])||"未命名页面"};const I=({children:e})=>{const n=a(),t=s(),[l,i]=(0,$.useState)([{key:"/",label:"首页",path:"/",closable:!1}]),[r,o]=(0,$.useState)("/"),[c,h]=(0,$.useState)(""),[d,m]=(0,$.useState)(null),[p,u]=(0,$.useState)(!1),b=(0,$.useCallback)(e=>{i(s=>{if(s.find(s=>s.path===e))return s;const a={key:e,label:H(e),path:e,closable:"/"!==e};return[...s,a]}),o(e)},[]),f=(0,$.useCallback)(e=>{i(s=>{const a=s.filter(s=>s.key!==e);if(e===r&&a.length>0){const n=s.findIndex(s=>s.key===e),l=a[n>0?n-1:0];l&&(o(l.key),t(l.path))}return a})},[r,t]),y=(0,$.useCallback)(e=>{o(e);const s=l.find(s=>s.key===e);s&&(u(!0),t(s.path),setTimeout(()=>{u(!1)},100))},[l,t]),k=(0,$.useCallback)(e=>{i(s=>s.filter(s=>s.key===e||!s.closable)),o(e);const s=l.find(s=>s.key===e);s&&t(s.path)},[l,t]),x=(0,$.useCallback)(()=>{i(e=>e.filter(e=>!e.closable)),o("/"),t("/")},[t]),j=(0,$.useCallback)(e=>{const s=l.find(s=>s.key===e);s&&(m(e),window.dispatchEvent(new CustomEvent("tab-refresh",{detail:{path:s.path,key:e}})),h(`${s.path}-${Date.now()}`),e!==r&&t(s.path))},[l,t,r]);return(0,$.useEffect)(()=>{b(n.pathname||"/")},[n.pathname,b]),(0,$.useEffect)(()=>{o(n.pathname||"/")},[n.pathname]),(0,O.jsx)(W.Provider,{value:{tabs:l,activeKey:r,refreshKey:c,refreshingKey:d,isTabSwitching:p,addTab:b,removeTab:f,setActiveTab:y,closeOtherTabs:k,closeAllTabs:x,refreshTab:j,setRefreshingKey:m,setIsTabSwitching:u},children:e})},M=()=>{const e=(0,$.useContext)(W);if(!e)throw new Error("useTabs must be used within TabsProvider");return e};var _=()=>{const{tabs:e,activeKey:s,setActiveTab:a,removeTab:n,closeOtherTabs:t,closeAllTabs:l,refreshTab:i}=M(),r=(0,$.useRef)(null),o=(0,$.useRef)(null),[c,h]=(0,$.useState)(new Set);(0,$.useEffect)(()=>{if(o.current&&r.current){const e=r.current,s=o.current,a=e.getBoundingClientRect(),n=s.getBoundingClientRect();n.left<a.left?e.scrollLeft=s.offsetLeft-20:n.right>a.right&&(e.scrollLeft=s.offsetLeft-a.width+n.width+20)}},[s]);return(0,O.jsxs)("div",{className:"asp-tabs-bar",children:[(0,O.jsx)("div",{ref:r,className:"asp-tabs-bar-container",children:e.map(l=>{const r=l.key===s;return(0,O.jsxs)("div",{ref:r?o:null,className:"asp-tabs-bar-item "+(r?"active":""),onClick:e=>((e,n)=>{n.stopPropagation(),e.key!==s&&a(e.key)})(l,e),onContextMenu:s=>((s,a)=>{a.preventDefault(),a.stopPropagation(),s.closable&&e.length>1&&t(s.key)})(l,s),children:[(0,O.jsx)("span",{className:"asp-tabs-bar-item-label",children:l.label}),(0,O.jsxs)("div",{className:"asp-tabs-bar-item-actions",children:[(0,O.jsx)("span",{className:"asp-tabs-bar-item-refresh "+(c.has(l.key)?"refreshing":""),title:"刷新页面",onClick:e=>((e,s)=>{s.stopPropagation(),h(s=>new Set(s).add(e.key)),i(e.key),setTimeout(()=>{h(s=>{const a=new Set(s);return a.delete(e.key),a})},500)})(l,e),children:(0,O.jsx)(x,{})}),l.closable&&(0,O.jsx)("span",{className:"asp-tabs-bar-item-close",title:"关闭标签",onClick:e=>((e,s)=>{s.stopPropagation(),n(e.key)})(l,e),children:(0,O.jsx)(y,{})})]})]},l.key)})}),e.length>1&&(0,O.jsx)("div",{className:"asp-tabs-bar-actions",children:(0,O.jsx)("span",{className:"asp-tabs-bar-action-item",title:"关闭所有标签",onClick:l,children:"关闭全部"})})]})},{Header:F,Sider:X,Content:q}=j,{Text:G}=E,J=()=>{const[e,n]=(0,$.useState)(!1),t=s(),i=a(),{refreshKey:r,refreshingKey:o,setRefreshingKey:d,isTabSwitching:m}=M(),[p,u]=(0,$.useState)(!1),y=(0,$.useRef)(null),{logout:k}=L(),x=(0,$.useMemo)(()=>{const e=i.pathname||"/",s=[];return null==z||z.forEach(a=>{a&&"string"!=typeof a&&("/"!==a.key||"/"!==e&&""!==e?a.key===e?s.push(e):"children"in a&&a.children&&a.children.forEach(a=>{a&&"string"!=typeof a&&a.key===e&&s.push(e)}):s.push("/"))}),s.length>0?s:["/"]},[i.pathname]),[N,T]=(0,$.useState)(()=>(e=>{const s=[];return null==z||z.forEach(a=>{a&&"string"!=typeof a&&"children"in a&&a.children&&a.children.some(s=>s&&"string"!=typeof s&&s.key===e)&&a.key&&s.push(a.key)}),s})(i.pathname||"/"));(0,$.useEffect)(()=>{const e=i.pathname||"/";if(null!==y.current&&y.current!==e&&!m){u(!0);const s=setTimeout(()=>{u(!1)},300);return y.current=e,()=>{clearTimeout(s)}}y.current=e},[i.pathname,m]),(0,$.useEffect)(()=>{if(o&&r){const e=setTimeout(()=>{d(null)},300);return()=>{clearTimeout(e)}}},[r,o,d]);const w=i.pathname||"/",S=null!==o&&o===w;return(0,O.jsxs)(j,{className:"asp-comprehension-home",style:{height:"100vh",overflow:"hidden"},children:[(0,O.jsxs)(X,{collapsible:!0,breakpoint:"md",className:"asp-comprehension-home-menu",collapsed:e,collapsedWidth:80,trigger:null,width:240,onBreakpoint:e=>{n(e)},children:[(0,O.jsx)("div",{className:"asp-comprehension-home-menu-header",children:(0,O.jsxs)("div",{className:"asp-comprehension-home-menu-logo",children:[(0,O.jsx)("div",{className:"asp-comprehension-home-menu-logo-icon",children:(0,O.jsx)(h,{})}),!e&&(0,O.jsx)("span",{className:"asp-comprehension-home-menu-logo-title",children:"不知道叫啥的某系统"})]})}),(0,O.jsx)("div",{className:"asp-comprehension-home-menu-divider"}),(0,O.jsx)(c,{className:"asp-comprehension-home-menu-content",items:z,mode:"inline",openKeys:N,selectedKeys:x,theme:"light",onClick:({key:e})=>{e.startsWith("/")&&t(e)},onOpenChange:e=>{T(e)}})]}),(0,O.jsxs)(j,{style:{height:"100%",overflow:"hidden"},children:[(0,O.jsx)(F,{className:"asp-comprehension-home-header",children:(0,O.jsxs)("div",{className:"asp-comprehension-home-header-content",children:[(0,O.jsx)("div",{className:"asp-comprehension-home-header-left",children:(0,O.jsx)("div",{className:"asp-comprehension-home-header-toggle",onClick:()=>n(!e),children:e?(0,O.jsx)(R,{}):(0,O.jsx)(b,{})})}),(0,O.jsx)("div",{className:"asp-comprehension-home-header-right",children:(0,O.jsx)(g,{menu:{items:B,onClick:({key:e})=>{"logout"===e?k().then(()=>{t("/login",{replace:!0})}):"profile"===e?t("/profile"):"settings"===e&&t("/settings/basic")}},placement:"bottomRight",children:(0,O.jsxs)(v,{className:"asp-comprehension-home-header-content-user",style:{cursor:"pointer"},children:[(0,O.jsx)(f,{icon:(0,O.jsx)(C,{}),size:32,style:{backgroundColor:"#237ffa"}}),(0,O.jsx)(G,{style:{fontSize:14,color:"#595959"},children:"管理员"})]})})})]})}),(0,O.jsx)(_,{}),(0,O.jsx)(q,{className:"asp-comprehension-home-content",children:(0,O.jsx)("div",{className:"asp-comprehension-home-content-wrapper",children:(0,O.jsx)(K,{size:"large",spinning:S||p,style:{height:"100%"},tip:S?"页面刷新中...":"页面加载中...",children:(0,O.jsx)("div",{style:{height:"100%"},children:(0,O.jsx)(A,{enableConsoleLog:!0,id:`Page-${i.pathname}`,children:(0,O.jsx)(l,{},`${i.pathname}-${r}`)})})})})})]})]})},Q=()=>(0,O.jsx)(I,{children:(0,O.jsx)(J,{})});export{Q as default};